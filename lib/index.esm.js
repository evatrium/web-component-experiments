import{extend as t,def as e}from"@iosio/util";import{render as i,h as s}from"preact";let r=document,h=()=>{let t=r.createElement("style");return t.appendChild(r.createTextNode("")),t.setAttribute("data-iosio","iosio-x"),r.head.appendChild(t),(e,i)=>(i?t.sheet.insertRule(e,t.sheet.cssRules.length):t.appendChild(r.createTextNode(e)),t)},o=(h(),h());o(" .___ {visibility: inherit;}",!0);const n=(t,e)=>{e=e||String;try{if(e==Boolean?t=[!0,1,"","1","true"].includes(t):"string"==typeof t&&(t=e==Number?Number(t):e==Object||e==Array?JSON.parse(t):e==Function?window[t]:e==Date?new Date(t):t),{}.toString.call(t)==`[object ${e.name}]`)return{value:t,error:e==Number&&Number.isNaN(t)}}catch(t){}return{value:t,error:!0}},l=(t,e,i)=>{null==i?t.removeAttribute(e):t.setAttribute(e,"object"==typeof i?JSON.stringify(i):i)},u=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase(),c=t=>t.replace(/-(\w)/g,(t,e)=>e.toUpperCase());let a=Symbol(),b=Symbol(),m={},p=()=>m;class d extends HTMLElement{constructor(){super(),this.update=()=>(this.t||(this.t=this.i.then(()=>{let e=t({context:p(),host:this},this[a]);this.s?this.shouldRerender(e)&&i(this.render(e),this.shadowRoot):(i(this.render(e),this.shadowRoot),setTimeout(()=>this.classList.add("___")),this.s=!0),this.t=!1})),this.t),this[a]={},this.context=p(),this.attachShadow({mode:"open"}),this.render=this.render.bind(this),this.shouldRerender=this.shouldRerender.bind(this),this.i=new Promise(t=>this.h=t),this.update();let{initAttrs:e}=this.constructor,s=e.length;for(;s--;)e[s](this)}attributeChangedCallback(t,e,i){t!==this[b]&&e!==i&&(this[c(t)]=i)}static get observedAttributes(){let{propTypes:t,prototype:i}=this;return this.initAttrs=[],t?Object.keys(t).map(s=>{let r=u(s),h=t[s].name?{type:t[s]}:t[s];return s in i||e(i,s,{get(){return this[a][s]},set(t){let{value:e,error:i}=n(t,h.type);if(i&&null!=e)throw`[${s}] must be type [${h.type.name}]`;e!==this[a][s]&&(h.reflect&&this.i.then(()=>{this[b]=r,l(this,r,h.type!==Boolean||e?e:null),this[b]=!1}),this[a][s]=e,this.update())}}),h.value&&this.initAttrs.push(t=>t[s]=h.value),r}):[]}shouldRerender(){return!0}connectedCallback(){this.s||this.h()}disconnectedCallback(){i(()=>null,this.shadowRoot)}render(){}}const y=(t,e,i)=>{var r,h;const{propTypes:n}=e;return(t=>{o(`${t} {visibility:hidden}`,!0)})(t),customElements.define(t,(h=r=class extends d{render(t){return s(e,t)}},r.propTypes=i||n,h)),e=>s(t,e,e.children)},f=(t,e,i)=>y("x-"+t,e,i);export{d as PWC,y as pwc,f as x};
